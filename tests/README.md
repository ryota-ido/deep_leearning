# テストモジュール (tests/)

## 概要
このモジュールは、機械学習フレームワークの各コンポーネントに対する単体テストと統合テストを提供します。テストの目的は、各モジュールが仕様通りに機能すること、リファクタリングや機能追加後も既存の機能が壊れていないことを確認することです。

## ディレクトリ構造
```
tests/
├── __init__.py                       # Pythonパッケージとして認識させるためのファイル
├── conftest.py                       # テスト共通の設定とフィクスチャ
├── test_base_model.py                # ベースモデル抽象クラスのテスト
├── test_data_loader.py               # データローダーとマネージャーのテスト
├── test_evaluator.py                 # モデル評価クラスのテスト
├── test_registry_components.py       # レジストリと登録されたコンポーネントのテスト
├── test_trainer.py                   # トレーナークラスのテスト
└── README.md                         # このファイル
```

## テストの実行方法

### 全テストの実行
```bash
# プロジェクトのルートディレクトリから
pytest tests/

# 詳細な出力を表示
pytest tests/ -v

# カバレッジレポートの生成
pytest --cov=src tests/
```

### 特定のテストの実行
```bash
# 特定のテストファイルを実行
pytest tests/test_base_model.py

# 特定のテスト関数を実行
pytest tests/test_base_model.py::test_model_fit

# 実行中のテスト内容を表示
pytest tests/test_base_model.py -v
```

## テスト内容

### BaseModelテスト (`test_base_model.py`)
モデルの基底クラスの機能をテストします。

- **初期化テスト**: モデルが正しく初期化されるか
- **fitメソッドテスト**: モデルの学習機能が正しく動作するか
- **predictメソッドテスト**: 学習後の予測が正しく行われるか
- **未学習モデルテスト**: 学習前の予測で適切なエラーが発生するか
- **保存・読み込みテスト**: モデルの状態が正しく保存・復元されるか
- **resetメソッドテスト**: モデルの状態が正しくリセットされるか

### DataLoaderテスト (`test_data_loader.py`)
データの読み込みと管理機能をテストします。

- **データ読み込みテスト**: CSVなどの各種形式のデータが正しく読み込まれるか
- **データ分割テスト**: トレーニングセットとテストセットへの分割が正しく行われるか
- **データ保存テスト**: 処理されたデータが正しく保存・読み込みされるか

### Evaluatorテスト (`test_evaluator.py`)
モデル評価機能をテストします。

- **評価器初期化テスト**: モデルタイプに応じた適切なメトリクスが設定されるか
- **回帰モデル評価テスト**: 回帰モデルの評価が正しく行われるか
- **メトリクス関数解決テスト**: 文字列からメトリクス関数が正しく解決されるか

### レジストリコンポーネントテスト (`test_registry_components.py`)
動的コンポーネント登録と検出機能をテストします。

- **モデルレジストリテスト**:
  - 登録された全ての回帰モデルが正常に機能するか
  - 登録された全ての分類モデルが正常に機能するか
  - 各モデルがTrainerと連携できるか

- **前処理レジストリテスト**:
  - 登録された全ての前処理コンポーネントが正常に機能するか
  - 前処理パイプラインで全てのコンポーネントが使用できるか

- **チューナーレジストリテスト**:
  - 登録された全てのチューナーが共通インターフェースを実装しているか
  - グリッドサーチチューナーが正常に機能するか

### Trainerテスト (`test_trainer.py`)
モデルトレーニング機能をテストします。

- **トレーナー初期化テスト**: トレーナーが正しく初期化されるか
- **trainメソッドテスト**: トレーニング機能が正しく動作するか
- **evaluateメソッドテスト**: Evaluatorと連携した評価が正しく行われるか
- **モデル保存・読み込みテスト**: モデルの保存と読み込みが正しく行われるか
- **パラメータ管理テスト**: パラメータの取得と設定が正しく行われるか

## テストフィクスチャ

`conftest.py`には、テスト間で共有されるフィクスチャが定義されています。主なフィクスチャは以下の通りです：

- **sample_model**: 単純な線形予測を行うテスト用モデル
- **sample_data**: 小規模なテスト用NumPyデータセット
- **sample_dataframe**: 小規模なテスト用DataFrameデータセット
- **temp_model_path**: モデルの保存と読み込みに使用する一時ファイルパス

## カスタムテストの追加

新しいコンポーネントを実装した場合は、対応するテストも追加することをお勧めします。

### テストファイル命名規則
- テストファイル名は`test_`で始める
- テスト関数名も`test_`で始める

### テスト実装例
```python
import pytest
from src.your_module import YourClass

@pytest.fixture
def your_fixture():
    """テスト用のフィクスチャ"""
    return YourClass(params)

def test_your_feature(your_fixture):
    """機能のテスト"""
    result = your_fixture.your_method()
    assert result == expected_value
```

## テストカバレッジ

テストカバレッジの目標は100%ですが、少なくとも以下の部分は確実にテストすべきです：

- すべての公開メソッド（publicメソッド）
- エラーケースと境界条件
- 複雑なロジック（分岐やループ）

カバレッジレポートは次のコマンドで生成できます：

```bash
pytest --cov=src tests/
```
